{% extends "base.html" %}

{% block title %}Tournament History{% endblock %}
{% block header_text %}Tournament History{% endblock %}

{% block main %}
<div class="container mt-4">
  <h2 class="mb-3">All Tournaments</h2>
  {% if tournaments %}
  <table class="table table-hover">
    <thead class="table-dark">
      <tr>
        <th>Created At</th>
        <th>Start Time</th>
        <th>Score</th>
        <th>ID</th>
        <th>Tournament</th>
        <th>Description</th>
        <th>Visibility</th>
      </tr>
    </thead>
    <tbody>
      {% for t in tournaments %}
      <tr>
        <td>{{ t.created_at.strftime('%Y-%m-%d %H:%M') if t.created_at else 'N/A' }}</td>
        <td>{{ t.start_time.strftime('%Y-%m-%d %H:%M') if t.start_time else 'N/A' }}</td>
        <td>
          {% if t.team_a and t.team_b %}
          {{ t.team_a_score }} : {{ t.team_b_score }}
          {% else %}
          N/A
          {% endif %}
        </td>
        <td>{{ t.id }}</td>
        <td><a href="/tournament?id={{ t.id }}">{{ t.title }}</a></td>
        <td>{{ t.description }}</td>
        <td>{{ t.visibility.visibility }}</td>
        <td class="text-center">
          <span role="button" data-bs-toggle="collapse" data-bs-target="#collapse-{{ t.id }}" aria-expanded="false"
            aria-controls="collapse-{{ t.id }}">
            â–¼
          </span>
        </td>
      </tr>
      <tr class="collapse" id="collapse-{{ t.id }}">
        <td colspan="7">
          <div class="border p-3 mb-3">

            <div class="text-center fw-bold fs-5">
              <!-- In case the game information is-invalid -->

              {% if t.team_a and t.team_b %}
              {{ t.team_a.team_name }} VS {{ t.team_b.team_name }}
              {% else %}
              Incomplete Tournament
              {% endif %}
            </div>
            <div class="text-center fs-4">
              {{ t.team_a_score }} : {{ t.team_b_score }}
            </div>
            <div class="text-center mb-2">
              <strong>
                {% if not t.team_a or not t.team_b %}
                Result: NONE
                {% elif t.team_a_score > t.team_b_score %}
                Winner: {{ t.team_a.team_name }}
                {% elif t.team_b_score > t.team_a_score %}
                Winner: {{ t.team_b.team_name }}
                {% else %}
                Result: DRAW
                {% endif %}
              </strong>
            </div>
            <div class="row">
              <div class="col">
                <strong>{{ t.team_a.team_name }}</strong>
                <ul class="list-unstyled">
                  {% for p in t.team_a_players %}
                  <li>{{ p }}</li>
                  {% endfor %}
                </ul>
              </div>
              <div class="col">
                <strong>{{ t.team_b.team_name }}</strong>
                <ul class="list-unstyled">
                  {% for p in t.team_b_players %}
                  <li>{{ p }}</li>
                  {% endfor %}
                </ul>
              </div>
            </div>
          </div>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
  <p>No tournaments found.</p>
  {% endif %}
</div>
{% endblock %}