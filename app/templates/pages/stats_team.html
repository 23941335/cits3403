{% extends "base.html" %}
{% block title %} Team Performance {% endblock %}
{% block header_text %} Team Performance During Tournament {% endblock %}

{% block main %}
<div class="container my-4">
    <div class="text-center">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h2 class="mb-0">{{ team.team_name }} Performance</h2>
            <div class="d-flex gap-2">
                <!-- View Mode dropdown -->
                <div class="dropdown">
                    <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" id="modeDropdown"
                        data-bs-toggle="dropdown" aria-expanded="false">
                        Team View
                    </button>
                    <ul class="dropdown-menu" aria-labelledby="modeDropdown">
                        <li><a class="dropdown-item active" href="#" onclick="switchModeView('team')">Team View</a></li>
                        <li><a class="dropdown-item" href="#" onclick="switchModeView('player')">Player View</a></li>
                    </ul>
                </div>

                <!-- Game View dropdown -->
                <div class="dropdown">
                    <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" id="viewDropdown"
                        data-bs-toggle="dropdown" aria-expanded="false">
                        This Tournament
                    </button>
                    <ul class="dropdown-menu" aria-labelledby="viewDropdown">
                        <li><a class="dropdown-item active" href="#" onclick="switchGameView('tournament')">Tournament
                                view</a></li>
                        <li><a class="dropdown-item" href="#" onclick="switchGameView('game')">Game view</a></li>
                    </ul>
                </div>
            </div>
        </div>

        <p>During <a href="/tournament?id={{ tournament.id }}">{{ tournament.title }}</a></p>
    </div>
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card text-center bg-light">
                <div class="card-body">
                    <h6 class="card-title">Games Played</h6>
                    <p class="card-text fs-4">{{ team_summary.games }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center bg-light">
                <div class="card-body">
                    <h6 class="card-title">Total Kills</h6>
                    <p class="card-text fs-4">{{ team_summary.total_kills }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center bg-light">
                <div class="card-body">
                    <h6 class="card-title">KDA Ratio</h6>
                    <p class="card-text fs-4">{{ team_summary.kda_ratio }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center bg-light">
                <div class="card-body">
                    <h6 class="card-title">Accuracy</h6>
                    <p class="card-text fs-4">{{ team_summary.avg_accuracy }}%</p>
                </div>
            </div>
        </div>
    </div>


    <!-- Placeholder for a graphic, to show time series improvement across various team stats -->
    <!-- Round selector block -->
    <div id="round-selector" class="mb-3 d-none">
        <div class="d-flex flex-wrap gap-2 justify-content-center">
            {% for r in range(1, max_round + 1) %}
            <button class="btn btn-outline-primary btn-sm">Round {{ r }}</button>
            {% endfor %}
        </div>
    </div>

    <!-- Tournament view (Dealt) -->
    <div id="game-view-tournament" class="game-table-view">
        <p class="text-muted">This Tournament view content here (placeholder).</p>
    </div>

    <!-- Game view  -->
    <div id="game-view-game" class="game-table-view" style="display: none;">
        <p class="text-muted">This Game view content here (placeholder).</p>
    </div>

    <div class="mb-4">
        <div class="bg-light border rounded">
            <img src="{{ url_for('static', filename='images/placeholder-graph.png') }}" class="img-fluid">
        </div>
    </div>
    <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 g-4">
        {% set stats = [
        {'name': 'Wins', 'value': 4},
        {'name': 'Losses', 'value': 2},
        {'name': 'Draws', 'value': 0},
        {'name': 'Total Kills', 'value': 245},
        {'name': 'Total Deaths', 'value': 198},
        {'name': 'Average K/D Ratio', 'value': 1.24},
        {'name': 'Total Assists', 'value': 112},
        {'name': 'Total Medals', 'value': 34},
        {'name': 'Total Final Hits', 'value': 67},
        {'name': 'Total Damage Dealt', 'value': '58,935'},
        {'name': 'Total Damage Blocked', 'value': '46,278'},
        {'name': 'Total Healing', 'value': '27,763'},
        {'name': 'Average Accuracy', 'value': '62.4%'},
        {'name': 'Average Kills', 'value': '42'},
        {'name': 'Average Damage', 'value': '9,822'},
        {'name': 'Average Healing', 'value': '4,627'}
        ] %}
        {% for stat in stats %}
        <div class="col">
            <div class="card h-100 text-center">
                <div class="card-body">
                    <h5 class="card-title">{{ stat.name }}</h5>
                    <p class="card-text" style="font-size: 2rem;">{{ stat.value }}</p>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
<script>

    function switchGameView(view) {
        document.getElementById("viewDropdown").textContent =
            view === "tournament" ? "This Tournament" : "Game View";

        // Set active class for the clicked dropdown item
        document.querySelectorAll(".dropdown-item").forEach(item => item.classList.remove("active"));
        document.querySelector(`.dropdown-item[onclick="switchGameView('${view}')"]`).classList.add("active");

        // switch game view
        document.querySelectorAll(".game-table-view").forEach(div => div.style.display = "none");
        const section = document.getElementById(`game-view-${view}`);
        if (section) section.style.display = "block";

        // Control round selector visibility
        // Show round selector only for game view
        const roundSelector = document.getElementById("round-selector");
        if (view === "game") {
            roundSelector.classList.remove("d-none");
        } else {
            roundSelector.classList.add("d-none");
        }
    }
    function switchModeView(mode) {
        document.getElementById("modeDropdown").textContent =
            mode === "team" ? "Team View" : "Player View";

        // Set active style
        document.querySelectorAll("#modeDropdown + .dropdown-menu .dropdown-item")
            .forEach(item => item.classList.remove("active"));
        document.querySelector(`#modeDropdown + .dropdown-menu .dropdown-item[onclick="switchModeView('${mode}')"]`)
            .classList.add("active");
    }
</script>

{% endblock %}