{% extends "base.html" %}

{% block title %}Tournament Manager{% endblock %}

{% block header_text %}Marvel Rivals Tournament Manager{% endblock %}

{% block style %}
{% endblock %}

{% block main %}
<h1>Tournament——{{ tournament.title }}</h1>
<p>{{ tournament.description }}</p>
<p>Start Time: {{ tournament.start_time.strftime('%Y-%m-%d %H:%M') }}</p>
<p>Visibility: {{ tournament.visibility.visibility }}</p>

{% for team in teams %}
<p>{{ team.team_name }}</p>
{% endfor %}
<h2 class="mt-4">Games in This Tournament</h2>

{% if games %}
  <div class="table-responsive">
    <table class="table table-striped table-bordered">
      <thead class="table-dark">
        <tr>
          <th>Round</th>
          <th>Team A</th>
          <th>Team B</th>
          <th>Game Mode</th>
          <th>Map</th>
          <th>Result</th>
          <th>Details</th>
        </tr>
      </thead>
      <tbody>
        {% for g in games %}
        <tr>
          <td>{{ g.round }}</td>
          <td>{{ g.team_a.team_name }}</td>
          <td>{{ g.team_b.team_name }}</td>
          <td>{{ g.game_mode.game_mode_name }}</td>
          <td>{{ g.map.map_name }}</td>
          <td>
            {% if g.is_draw %}
              Draw
            {% elif g.winning_team == g.team_a.id %}
              {{ g.team_a.team_name }} Wins
            {% elif g.winning_team == g.team_b.id %}
              {{ g.team_b.team_name }} Wins
            {% else %}
              Unknown
            {% endif %}
          </td>
          <td>
            <a class="btn btn-sm btn-outline-primary me-2" href="/tournament/game?id={{ g.id }}">Full View</a>
              <button class="btn btn-sm btn-outline-secondary"
                data-bs-toggle="collapse"
                data-bs-target="#details-{{ g.id }}"
                aria-expanded="false"
                aria-controls="details-{{ g.id }}">
                  Players
              </button>
            </td>
        </tr>
        <tr class="collapse" id="details-{{ g.id }}">
          <td colspan="7">
            <div class="border p-3">
              <h5>Players in this Game</h5>
                <div class="row row-cols-1 row-cols-md-2 g-3">
                  {% for gp in g.game_players %}
                <div class="col">
              <div class="card h-100 p-2">
              <h6 class="card-title">{{ gp.player.gamertag }}</h6>
              <p class="mb-1">Hero: {{ gp.hero.hero_name if gp.hero else 'Unknown' }}</p>
              <p class="mb-1">Kills / Deaths / Assists: {{ gp.kills }} / {{ gp.deaths }} / {{ gp.assists }}</p>
              <p class="mb-1">Damage: {{ gp.damage }} | Healing: {{ gp.healing }} | Accuracy: {{ gp.accuracy_pct }}%</p>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
  </td>
</tr>

        {% endfor %}
      </tbody>
    </table>
  </div>
{% else %}
  <p>No games found for this tournament.</p>
{% endif %}


{% endblock %}